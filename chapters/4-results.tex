\documentclass[../main.tex]{subfiles}

\begin{document}

\chapter{Results}
\label{sec:results}
The results can be split into two parts: (1) \textit{pre-training} which includes the experimental data after filtering and pre-processing and before the training of the \ac{NN}; and (2) \textit{post-training} which includes the output from the trained \ac{NN} model, including training and performance evaluation.

\section{Pre-training results}
\label{sec:results_pre-training-results}
Before training the \ac{NN} it is useful to examine what the data looks like.
Figure \ref{fig:kjm-average} shows a representation of the \ac{KJM} from all the gait cycles for subjects 1, 2 and 6.
Same plots can be found for subject 3 and 5 in the appendix \ref{sec:appendix}. 
Figure \ref{fig:emg-average} shows the corresponding \ac{EMG} activity of each muscle, grouped by the muscle's main function as per table \ref{tab:muscle-names}.
\begin{figure}[ht!]
     \centering
     \begin{subfigure}[b]{0.328\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/results/moment_avg/subject01_all_set1_moment_avg_w_minmax.png}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.328\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/results/moment_avg/subject02_all_set1_moment_avg_w_minmax.png}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.328\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/results/moment_avg/subject06_all_set1_moment_avg_w_minmax.png}
     \end{subfigure}
    \caption{Normalized \ac{KJM} for subjects 1, 2, and 6, from left to right respectively. The x-axis is the percentage of a single gait cycle. The solid blue line is the average from all the gait cycles and the shaded area around it is the standard deviation.}
    \label{fig:kjm-average}
\end{figure}
\begin{figure}[ht!]
    \centering
    \includegraphics[width=\textwidth]{img/results/emg_avg/all_subject_grid_emg_avg.png}
    \caption{Filtered and normalized \ac{EMG} from subjects 1, 2, and 6. The x-axis is the percentage of a single gait cycle. The solid blue lines represent the average from all the gait cycles for each muscle and the shaded area with corresponding color is the standard deviation.}
    \label{fig:emg-average}
\end{figure}
% \begin{figure}
%     \centering
%     \includegraphics[width=0.75\textwidth]{img/results/20190429_06_moments_normal_walk.png}
%     \caption{Knee joint moments from part of the trial of subject00 where gait cycles are considered as "normal" walking speed. Positive moment means knee flexion and negative knee extension. The values are normalized as explained in the chapter \ref{sec:methods}. The light-blue area around the average represents the standard deviation. This dataset includes 523 gait cycles. See figure \ref{fig:knee-joint-moments-stat-compl} for complementing dataset, i.e. "slow" and "fast" walking speeds. }
%     \label{fig:knee-joint-moments-stat}
% \end{figure}
The figures show the subjects have similar patterns for \acp{KJM} and \ac{EMG} signals over the gait cycles.
Note that the pattern for subject 1 is not as clear as for subjects 2 and 6 when looking at it on the same scale.
However, as indicated by the ``fastest'' and ``slowest'' cycles, it is because subject 1 generally walked slower, in most trials, compared to their maximum speed.

Considering similar patterns across subjects, an \ac{NN} might be able to generalize between subjects, at least up to some degree.
The linear correlation between the average for each subject, for each of the muscles and the \ac{KJM}, is plotted in figures \ref{fig:kjm-correlation}--\ref{fig:gaslat-correlation}.
Table \ref{tab:correlation-sumup} outlines the results from these plots.
\input{tables/correlations-sumup.tex}
This table indicates that the patterns are generally correlated between subjects, except for the pattern of gluteus maximus.
% Figure \ref{fig:kjm-correlation} shows the correlation of the \ac{KJM} between all the subjects.
% \begin{figure}[ht!]
%     \centering
%     \includegraphics[width=0.9\textwidth]{img/results/correlations/KJM_correlation_between_subjects.png}
%     \caption{\ac{KJM} correlation between subjects. The table shows the Pearson correlation coefficient between the average normalized \ac{KJM} of each subject.}
%     \label{fig:kjm-correlation}
% \end{figure}
% The figure indicates high linear correlation between all the subjects.

Nevertheless, there are also some dissimilarities between the signals which are discussed further in chapter \ref{sec:discussion}.

Another notable observation is the amplitude of the normalized \ac{EMG}.
It indicates that most of the values have below $0.5$ amplitude.
This suggests that the normalization method might not be adequate.
The discrepancy between the signals from gluteus maximus (GlutMax) may suggest the same. 
This is further discussed in section \ref{sec:discussion}.

\section{Post-training results}
\label{sec:post-training-results}
The following figures and tables show the training and performance results of the model for each case.
\subsection{Case 1}
\label{sec:results-case1}
\input{tables/Case1_models_test-eval.tex}
\begin{figure}[ht!]
     \centering
     \begin{subfigure}[b]{0.475\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/results/training_history/Case1_LSTMvsMLP_training.png}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.515\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/results/test_prediction_evaluation/Case1_LSTM_test_prediction.png}
     \end{subfigure}
    \caption{Case 1 model performance: (left) The training and validation set's \ac{MSE} per epoch during training; (right) The average normalize \ac{KJM} for the test set, showing \ac{LSTM} model prediction vs. actual (i.e. CGM2 model outputs).}
    \label{fig:case1-performance-plots}
\end{figure}

\subsection{Case 2}
\label{sec:results-case2}
\input{tables/Case2_models_test-eval.tex}
\begin{figure}[ht!]
     \centering
     \begin{subfigure}[b]{0.466\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/results/training_history/Case2_LSTMvsMLP_training.png}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.524\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/results/test_prediction_evaluation/Case2_LSTM_test_prediction.png}
     \end{subfigure}
    \caption{Case 2 model performance: (left) The training and validation set's \ac{MSE} per epoch during training; (right) The average normalize \ac{KJM} for the test set, showing \ac{LSTM} model prediction vs. actual (i.e. CGM2 model outputs).}
    \label{fig:case2-performance-plots}
\end{figure}

\subsection{Case 3}
\label{sec:results-case3}
\input{tables/Case3_models_test-eval.tex}
\begin{figure}[ht!]
     \centering
     \begin{subfigure}[b]{0.466\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/results/training_history/Case3_LSTMvsMLP_training.png}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.524\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/results/test_prediction_evaluation/Case3_LSTM_test_prediction.png}
     \end{subfigure}
    \caption{Case 3 model performance: (left) The training and validation set's \ac{MSE} per epoch during training; (right) The average normalize \ac{KJM} for the test set, showing \ac{LSTM} model prediction vs. actual (i.e. CGM2 model outputs).}
    \label{fig:case3-performance-plots}
\end{figure}

\subsection{Case 4}
\label{sec:results-case4}
\input{tables/Case4_models_test-eval.tex}
\begin{figure}[ht!]
     \centering
     \begin{subfigure}[b]{0.466\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/results/training_history/Case4_LSTMvsMLP_training.png}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.524\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/results/test_prediction_evaluation/Case4_LSTM_test_prediction.png}
     \end{subfigure}
    \caption{Case 4 model performance: (left) The training and validation set's \ac{MSE} per epoch during training; (right) The average normalize \ac{KJM} for the test set, showing \ac{LSTM} model prediction vs. actual (i.e. CGM2 model outputs).}
    \label{fig:case4-performance-plots}
\end{figure}

\subsection{Case 5}
\label{sec:results-case5}
\todo{This result looks weird, probably something wrong here which needs to be fixed.}
\input{tables/Case5_models_test-eval.tex}
\begin{figure}[ht!]
     \centering
     \begin{subfigure}[b]{0.466\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/results/training_history/Case5_LSTMvsMLP_training.png}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.524\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/results/test_prediction_evaluation/Case5_LSTM_test_prediction.png}
     \end{subfigure}
    \caption{Case 5 model performance: (left) The training and validation set's \ac{MSE} per epoch during training; (right) The average normalize \ac{KJM} for the test set, showing \ac{LSTM} model prediction vs. actual (i.e. CGM2 model outputs).}
    \label{fig:case5-performance-plots}
\end{figure}

\end{document}
